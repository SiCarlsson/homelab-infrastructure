services:
  pgadmin:
    image: dpage/pgadmin4:{{ pgadmin_version }}
    container_name: pgadmin
    restart: unless-stopped
    environment:
      - PGADMIN_DEFAULT_EMAIL={{ pgadmin_email }}
      - PGADMIN_DEFAULT_PASSWORD={{ pgadmin_password }}
      - PGADMIN_CONFIG_ENHANCED_COOKIE_PROTECTION=True
      - PGADMIN_CONFIG_CONSOLE_LOG_LEVEL=10
      - PGADMIN_SERVER_JSON_FILE=/pgadmin4/servers.json
    volumes:
      - {{ pgadmin_data_dir }}:/var/lib/pgadmin
      - {{ pgadmin_config_dir }}/servers.json:/pgadmin4/servers.json:ro
    security_opt:
      - no-new-privileges:true
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pgadmin.rule=Host(`{{ pgadmin_domain }}`)"
      - "traefik.http.routers.pgadmin.entrypoints=websecure"
      - "traefik.http.routers.pgadmin.tls.certresolver=cloudflare"
      - "traefik.http.routers.pgadmin.tls.domains[0].main=*.{{ lookup('env', 'HOMELAB_DOMAIN') | default('example.com') }}"
      - "traefik.http.services.pgadmin.loadbalancer.server.port=80"
    networks:
      - {{ pgadmin_traefik_network }}

networks:
  {{ pgadmin_traefik_network }}:
    external: true
