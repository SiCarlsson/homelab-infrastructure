---
- name: Install Docker and Docker Compose on homelab VMs
  hosts: all
  become: yes
  gather_facts: yes

  roles:
    - role: ../roles/docker

  post_tasks:
    - name: Verify Docker is working
      command: docker --version
      register: docker_version
      changed_when: false
      become: no

    - name: Verify Docker daemon is running (as root)
      command: docker info
      register: docker_info
      changed_when: false
      become: yes

    - name: Display setup completion
      debug:
        msg:
          - "ðŸŽ‰ Docker setup completed successfully!"
          - "âœ… {{ docker_version.stdout }}"
          - "âœ… Docker daemon is running and ready"
          - "âœ… User added to docker group automatically"
